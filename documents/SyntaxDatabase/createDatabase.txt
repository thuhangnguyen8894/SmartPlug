CREATE DATABASE SMARTDEVICE;
USE SMARTDEVICE;

CREATE TABLE Timer(
    idTimer CHAR(20),
    daySD INT,
    monthSD INT,
    yearSD INT,
    hourSD INT,
    minuteSD INT,
    secondSD INT,
    PRIMARY KEY(idTimer));
    
CREATE TABLE SmartDevice(
    idSmartDevice CHAR(10),
    nameSmartDevice CHAR(20),
    stateElectric CHAR(10),
    stateRelay CHAR(10),
    ip_port CHAR(20),
    idRoom CHAR(10),
    PRIMARY KEY(idSmartDevice),
    UNIQUE KEY(ip_port));

CREATE TABLE Device_Timer(
    idTimer CHAR(20),
    idSmartDevice CHAR(10),
    stateElectric CHAR(10),
    stateRelay CHAR(10),
    PRIMARY KEY(idTimer, idSmartDevice));
    
CREATE TABLE Room( idRoom CHAR(10), nameRoom CHAR(20), PRIMARY KEY(idRoom));

CREATE TABLE User(
    idUser CHAR(16),
    userName CHAR(40),
    password CHAR(50),
    email CHAR(50),
    stateUser INT,
    userStyle INT,
    PRIMARY KEY(idUser),
    CONSTRAINT UNQ_User UNIQUE KEY(userName,email));

CREATE TABLE Room_User(idRoom CHAR(10), idUser CHAR(16), PRIMARY KEY(idRoom,idUser));

ALTER TABLE Device_Timer ADD CONSTRAINT fk_Timer FOREIGN KEY (idTimer) REFERENCES Timer(idTimer);

ALTER TABLE Device_Timer ADD CONSTRAINT fk_Device FOREIGN KEY (idSmartDevice) REFERENCES SmartDevice(idSmartDevice);

ALTER TABLE SmartDevice ADD CONSTRAINT fk_Room FOREIGN KEY (idRoom) REFERENCES Room(idRoom);

ALTER TABLE Room_User ADD CONSTRAINT fk_Room_User FOREIGN KEY (idRoom) REFERENCES Room(idRoom);

ALTER TABLE Room_User ADD CONSTRAINT fk_User FOREIGN KEY (idUser) REFERENCES User(idUser);